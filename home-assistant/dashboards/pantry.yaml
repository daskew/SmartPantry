# =============================================
# PANTRY DASHBOARD CARD
# =============================================

# Overview section
- type: sections
  title: Smart Pantry
  sections:

    # Summary tiles
    - type: grid
      title: Overview
      cards:
        - type: tile
          entity: sensor.smart_pantry_all_items
          name: Total Items
          icon: mdi:fridge
          color: green

        - type: tile
          entity: sensor.smart_pantry_expiring_3
          name: Expiring Soon
          icon: mdi:alert-circle
          color: red

        - type: tile
          entity: sensor.template_pantry_next_expiry
          name: Next to Expire
          icon: mdi:calendar-alert
          color: amber

        - type: tile
          entity: sensor.template_pantry_total_quantity
          name: Total Units
          icon: mdi:package-variant
          color: blue

    # Items list
    - type: markdown
      title: Items
      content: >
        {% set items = state_attr('sensor.smart_pantry_all_items', 'items') %}
        
        {% if not items or items | length == 0 %}
        
        **Your pantry is empty!**
        
        {% else %}
        
        | Item | Qty | Expires | Status |
        |------|-----|----------|--------|
        {% for item in items | sort(attribute='expiration_date') %}
        {% set days = ((as_timestamp(strptime(item.expiration_date, '%Y-%m-%d')) - as_timestamp(now())) / 86400) | round(0) %}
        {% if days < 0 %}
        | ~~{{ item.name }}~~ | {{ item.quantity }} | {{ item.expiration_date }} | ðŸ”´ |
        {% elif days <= 3 %}
        | {{ item.name }} | {{ item.quantity }} | {{ item.expiration_date }} | ðŸŸ  {{ days }}d |
        {% elif days <= 7 %}
        | {{ item.name }} | {{ item.quantity }} | {{ item.expiration_date }} | ðŸŸ¡ {{ days }}d |
        {% else %}
        | {{ item.name }} | {{ item.quantity }} | {{ item.expiration_date }} | ðŸŸ¢ {{ days }}d |
        {% endif %}
        {% endfor %}
        
        {% endif %}

    # Quick actions
    - type: horizontal-stack
      cards:
        - type: button
          name: Add Item
          icon: mdi:plus
          tap_action:
            url: https://smartpantry.vercel.app
          icon_height: 48px

        - type: button
          name: Refresh
          icon: mdi:refresh
          tap_action:
            action: call-service
            service: homeassistant.reload_all
          icon_height: 48px
